# 1. fopen与open的区别

```cpp
int open(const char *path, int access,int mode)  
    path 要打开的文件路径和名称                             
    access 访问模式，宏定义和含义如下：                          
        O_RDONLY         1    只读打开                           
        O_WRONLY         2    只写打开                           
        O_RDWR           4    读写打开                       
        还可选择以下模式与以上3种基本模式相与：                      
            O_CREAT     0x0100   创建一个文件并打开                  
            O_TRUNC     0x0200   打开一个已存在的文件并将文件长度设置为0，其他属性保持           
            O_EXCL      0x0400   未使用                              
            O_APPEND    0x0800   追加打开文件                       
            O_TEXT      0x4000   打开文本文件翻译CR-LF控制字符       
            O_BINARY    0x8000   打开二进制字符，不作CR-LF翻译                                                          
    mode 该参数仅在access=O_CREAT方式下使用，其取值如下：        
        S_IFMT      0xF000   文件类型掩码                        
        S_IFDIR     0x4000   目录                                
        S_IFIFO     0x1000   FIFO 专用                           
        S_IFCHR     0x2000   字符专用                            
        S_IFBLK     0x3000   块专用                              
        S_IFREG     0x8000   只为0x0000                          
        S_IREAD     0x0100   可读                                
        S_IWRITE    0x0080   可写                                
        S_IEXEC     0x0040   可执行  
```

```cpp
FILE *fopen(char *filename, char *mode)  
    filename 文件名称  
    mode 打开模式：                                              
        r   只读方式打开一个文本文件                             
        rb  只读方式打开一个二进制文件                           
        w   只写方式打开一个文本文件                             
        wb  只写方式打开一个二进制文件                           
        a   追加方式打开一个文本文件                             
        ab  追加方式打开一个二进制文件                           
        r+  可读可写方式打开一个文本文件                         
        rb+ 可读可写方式打开一个二进制文件                       
        w+  可读可写方式创建一个文本文件                         
        wb+ 可读可写方式生成一个二进制文件                       
        a+  可读可写追加方式打开一个文本文件                     
        ab+ 可读可写方式追加一个二进制文件  
```

区别：

1. 缓冲文件系统与非缓冲文件系统的区别

   缓冲文件系统（fopen）：在内存为每个文件开辟一个缓存区，当执行读操作，从磁盘文件将数据读入内存缓冲区，装满后从内存缓冲区依次读取数据。写操作同理。内存缓冲区的大小影响着实际操作外存的次数，缓冲区越大，操作外存的次数越少，执行速度快，效率高。缓冲区大小由机器而定。

   借助文件结构体指针对文件管理，可读写字符串、格式化数据、二进制数据。

   非缓冲文件系统(open)：依赖操作系统功能对文件读写，不设文件结构体指针，只能读写二进制文件。

2. open属于低级IO，fopen属于高级IO

3. open返回文件描述符，属于用户态，读写需进行用户态与内核态切换。 fopen返回文件指针。

4. open是系统函数，不可移植；fopen是标准C函数，可移植

5. 一般用fopen打开普通文件，open打开设备文件

6. 如果顺序访问文件，fopen比open快；如果随机访问文件，open比fopen快。



# 2. linux用户态与内核态

权限不同，用户态的进程能够访问的资源受到了极大的控制，而运行在内核态的进程可以“**为所欲为**”。

从用户态到内核态切换可以通过三种方式：

1. 系统调用，这个上面已经讲解过了，在我公众号之前的文章也有讲解过。其实系统调用本身就是中断，但是软件中断，跟硬中断不同。
2. 异常：如果当前进程运行在用户态，如果这个时候发生了异常事件，就会触发切换。例如：缺页异常。
3. 外设中断：当外设完成用户的请求时，会向CPU发送中断信号。

